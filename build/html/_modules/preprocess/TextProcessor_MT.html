
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>preprocess.TextProcessor_MT &#8212; Documentation Public Speaking Automatic Assessment with AudioTextual Features 1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Code source de preprocess.TextProcessor_MT</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This script extracts textual features based on the methodology described in:</span>

<span class="sd">    &quot;Automated Assessment of Non-Native Learner Essays: Investigating the Role of Linguistic Features&quot;</span>
<span class="sd">    by Sowmya Vajjala, International Journal of Artificial Intelligence in Education, 2016.</span>
<span class="sd">    Available at: https://api.semanticscholar.org/CorpusID:3666482</span>

<span class="sd">@author:</span>
<span class="sd">    Alisa Barkar &lt;alisa.george.barkar@gmail.com&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># NLP</span>
<span class="kn">from</span> <span class="nn">flair.data</span> <span class="kn">import</span> <span class="n">Sentence</span>
<span class="kn">from</span> <span class="nn">flair.models</span> <span class="kn">import</span> <span class="n">SequenceTagger</span>
<span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">import</span> <span class="nn">gensim.models</span> <span class="k">as</span> <span class="nn">g</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">wordnet</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="c1"># System</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="c1"># Data &amp; Mathmatics</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c1"># Import the config reader</span>
<span class="kn">from</span> <span class="nn">config_reader</span> <span class="kn">import</span> <span class="n">read_config</span>
<span class="c1"># Global</span>
<span class="k">global</span> <span class="n">featureCategories</span>
<span class="k">global</span> <span class="n">dataset</span>
<span class="k">global</span> <span class="n">language</span>


<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Manipulation with french and english POSTagging</span>
<span class="c1">#---------------------------------------------------------------------</span>
<div class="viewcode-block" id="nbTokens"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.nbTokens">[docs]</a><span class="k">def</span> <span class="nf">nbTokens</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the total number of tokens in a given document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list of frencToken): Represents a document as a list of frencToken objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">    int: Total number of tokens in the document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></div>

<div class="viewcode-block" id="nbType"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.nbType">[docs]</a><span class="k">def</span> <span class="nf">nbType</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the number of unique part-of-speech (POS) types in a given document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list of frencToken): Represents a document as a list of frencToken objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">    int: Number of unique POS types in the document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">tokenTypes</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span></div>

<div class="viewcode-block" id="tokenTypes"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.tokenTypes">[docs]</a><span class="k">def</span> <span class="nf">tokenTypes</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts the occurrences of each part-of-speech (POS) tag in a given document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list of frencToken): Represents a document as a list of frencToken objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: A dictionary where keys are POS tags and values are the counts of tokens with each POS tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">types</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">types</span></div>


<span class="c1"># This function takes doc = nlp(transcript) with fr_core_news_sm</span>
<span class="c1"># And gives a list of lists where each one is (word, lemma, POS, general tag)</span>
<span class="c1">#TODO: lowercase !!!! for lemmas at least!!</span>
<div class="viewcode-block" id="frencToken"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.frencToken">[docs]</a><span class="k">class</span> <span class="nc">frencToken</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for representing French tokens with linguistic annotations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    self.text (str): Actual word or token.</span>
<span class="sd">    self.lemma\_ (str): Lemma (base form) of the word.</span>
<span class="sd">    self.pos\_ (str): Part-of-speech (POS) tag of the word.</span>
<span class="sd">    self.tag\_ (str): Additional tag associated with the word.</span>

<span class="sd">    Methods:</span>
<span class="sd">    __init__(self, text=None, lemma=None, pos=None, tag=None): Initializes the token object.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lemma</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize frencToken object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        text (str, optional): Actual word or token.</span>
<span class="sd">        lemma (str, optional): Lemma (base form) of the word.</span>
<span class="sd">        pos (str, optional): Part-of-speech (POS) tag of the word.</span>
<span class="sd">        tag (str, optional): Additional tag associated with the word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lemma_</span> <span class="o">=</span> <span class="n">lemma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_</span> <span class="o">=</span> <span class="n">tag</span></div>

<div class="viewcode-block" id="frenchDoc"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.frenchDoc">[docs]</a><span class="k">class</span> <span class="nc">frenchDoc</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for storing French language document annotations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    self.text (str): Full text of the document.</span>
<span class="sd">    self.docFull (list): List of tokens with annotations [`spacyToken.text`, `spacyToken.lemma_`, `spacyToken.pos_`, `tag`].</span>
<span class="sd">    self.docPerSent (list): List of sentences, each containing a list of tokens with annotations.</span>

<span class="sd">    Methods:</span>
<span class="sd">    __init__(self, listOfFrenchSentences): Initializes the object with a list of annotated sentences.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listOfFrenchSentences</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize frenchDoc object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        listOfFrenchSentences (list of lists): List of sentences where each sentence is a list of tokens with annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docFull</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">listOfFrenchSentences</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docFull</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">word</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">docPerSent</span> <span class="o">=</span> <span class="n">listOfFrenchSentences</span></div>


<div class="viewcode-block" id="sentenceSeparation"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.sentenceSeparation">[docs]</a><span class="k">def</span> <span class="nf">sentenceSeparation</span><span class="p">(</span><span class="n">transcript</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for separating sentences in the case where there is no punctuation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    transcript (str): Full text of the .txt file.</span>

<span class="sd">    Returns:</span>
<span class="sd">    sentences (list of strings): List of sentences extracted from the text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO: because of automatic annotation there is no sentences</span>
    <span class="c1"># Time: 180 sec</span>
    <span class="c1"># average length of sentence in french (words): 10-15</span>
    <span class="n">transcript</span> <span class="o">=</span> <span class="n">transcript</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">nbOfWords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">nbOfWords</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">end</span> <span class="p">):</span>
            <span class="n">sentByWord</span> <span class="o">=</span> <span class="n">transcript</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">sentByWord</span> <span class="o">=</span> <span class="n">transcript</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
        
        <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentByWord</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sentences</span></div>


<div class="viewcode-block" id="fullTaggingForFrench"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.fullTaggingForFrench">[docs]</a><span class="k">def</span> <span class="nf">fullTaggingForFrench</span><span class="p">(</span><span class="n">transcript</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that provides frenchDoc class object for the given text. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    transcript (str): Full text of the .txt file. </span>

<span class="sd">    Returns:</span>
<span class="sd">    doc (frenchDoc class object): Object with three main attributes .docFull, .docPerSent, and .text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SequenceTagger</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;qanastek/pos-french&quot;</span><span class="p">)</span>
    <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fr_core_news_sm&#39;</span><span class="p">)</span>
   
    <span class="c1"># List of sentences</span>
    <span class="n">taggedDocBySent</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Separation on sentences if there is NO punctuation in transcript:</span>
    <span class="c1"># sentences = sentenceSeparation(transcript)</span>

    <span class="c1"># Separation on sentences if there is punctuation in transcript:</span>
    <span class="c1"># sentences = transcript.split(&#39;.&#39;)</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">transcript</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="c1">#print(&quot;____________________________________________\n&quot;)</span>
    <span class="c1">#print(sentences)</span>
    <span class="c1">#print(&quot;____________________________________________\n&quot;)</span>
    <span class="n">listOfSentences</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
        <span class="c1"># Create sentence object out of doc</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">Sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="c1"># Predict tags</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="c1"># Split tagged object to get list of pairs word-tag</span>
        <span class="c1">#print(string, &quot;\n&quot;)</span>
        <span class="n">taggedText</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">to_tagged_string</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;→&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="c1"># Creates a list of pairs (token_text, token_tag)</span>
        <span class="n">taggedText</span> <span class="o">=</span> <span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">taggedText</span><span class="p">]</span>
        <span class="c1"># extract POS via spacy </span>
        <span class="n">spacyPOS</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="c1"># Create a list of tokens in the sentence</span>
        <span class="n">listOfTokens</span> <span class="o">=</span> <span class="p">[</span> <span class="n">frencToken</span><span class="p">(</span><span class="n">spacyToken</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">spacyToken</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="n">spacyToken</span><span class="o">.</span><span class="n">pos_</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">spacyToken</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">taggedText</span><span class="p">,</span> <span class="n">spacyPOS</span><span class="p">)]</span>
        <span class="n">listOfSentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listOfTokens</span><span class="p">)</span>

    <span class="n">doc</span> <span class="o">=</span> <span class="n">frenchDoc</span><span class="p">(</span><span class="n">listOfSentences</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doc</span></div>

<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Preprocess raw transcript and split it into sentences</span>
<span class="c1">#---------------------------------------------------------------------</span>


<div class="viewcode-block" id="text2sentence"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.text2sentence">[docs]</a><span class="k">def</span> <span class="nf">text2sentence</span><span class="p">(</span><span class="n">transcript_dir</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that loads text from a transcript file, performs NLP tagging, and creates a frenchDoc class object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    transcript_dir (str): Directory path containing the transcript files.</span>
<span class="sd">    id (str): ID of the .txt file in the directory with transcripts.</span>
<span class="sd">    language (str): Language of the transcript (&#39;french&#39; or &#39;english&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">    doc (frenchDoc class object): Object with three main attributes .docFull, .docPerSent, and .text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">transcript_dir</span><span class="p">,</span> <span class="nb">id</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fr_core_news_sm&#39;</span><span class="p">)</span>
    <span class="c1">#nlp.pipe_labels[&#39;tagger&#39;]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">):</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fullTaggingForFrench</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># #print([token.tag_ for token in doc ])</span>
    <span class="c1"># test_docs = [sent.text.split() for sent in doc.sents]</span>
    <span class="k">return</span> <span class="n">doc</span></div>


<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Word Level Features of Lexical diversity</span>
<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Those features are taken from article</span>
<span class="c1"># paper: Automated assessment of non-native learner essays: Investigating the role of linguistic features</span>
<span class="c1"># authors: Sowmya Vajjala, Iowa State University, USA sowmya@iastate.edu</span>

<div class="viewcode-block" id="measureOfTextualLexicalDiversity"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.measureOfTextualLexicalDiversity">[docs]</a><span class="k">def</span> <span class="nf">measureOfTextualLexicalDiversity</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for MTLD calculation. </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    doc (list): A list of tokens or lemmas from the document.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: MTLD value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lemmasList</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span>

    <span class="n">types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ttrThreshold</span> <span class="o">=</span> <span class="mf">0.72</span>
    <span class="n">startIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ttr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">lemmasList</span><span class="p">:</span>
        <span class="n">types</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">ttr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">startIndex</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ttr</span> <span class="o">&lt;</span> <span class="mf">0.72</span><span class="p">):</span>
            <span class="n">startIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">types</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">factors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ttr</span> <span class="o">&gt;</span> <span class="n">ttrThreshold</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">factors</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ttr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.72</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">mtld1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span> <span class="o">/</span> <span class="n">factors</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">startIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">ttr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">types</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)):</span>
        <span class="n">types</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="n">ttr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">startIndex</span> <span class="o">-</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ttr</span> <span class="o">&lt;</span> <span class="mf">0.72</span><span class="p">):</span>
            <span class="n">startIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">types</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">factors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ttr</span> <span class="o">&gt;</span> <span class="n">ttrThreshold</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">factors</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ttr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.72</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="n">mtld2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lemmasList</span><span class="p">)</span> <span class="o">/</span> <span class="n">factors</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">mtld1</span> <span class="o">+</span> <span class="n">mtld2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="lexicalDiversity"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.lexicalDiversity">[docs]</a><span class="k">def</span> <span class="nf">lexicalDiversity</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for lexical diversity feature calculation. </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    doc (list): A list of lists where each inner list represents [word, word.lemma, word.pos, word.tag]</span>

<span class="sd">    Returns:</span>
<span class="sd">    list: List of lexical diversity features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nb_types</span> <span class="o">=</span> <span class="n">nbType</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">nb_tokens</span> <span class="o">=</span> <span class="n">nbTokens</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">TTR</span> <span class="o">=</span> <span class="n">nb_types</span><span class="o">/</span><span class="n">nb_tokens</span>
    <span class="n">CorrectedTTR</span> <span class="o">=</span> <span class="n">nb_types</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nb_tokens</span><span class="p">)</span>
    <span class="n">RootTTR</span> <span class="o">=</span> <span class="n">nb_types</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nb_tokens</span><span class="p">)</span>
    <span class="n">BilogTTR</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nb_types</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nb_tokens</span><span class="p">)</span>
    <span class="n">MTLD</span> <span class="o">=</span> <span class="n">measureOfTextualLexicalDiversity</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">TTR</span><span class="p">,</span> <span class="n">CorrectedTTR</span><span class="p">,</span> <span class="n">RootTTR</span><span class="p">,</span> <span class="n">BilogTTR</span><span class="p">,</span> <span class="n">MTLD</span><span class="p">]</span></div>



<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># POS Tag Density features: fr &amp; eng</span>
<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Those features are taken from article</span>
<span class="c1"># paper: Automated assessment of non-native learner essays: Investigating the role of linguistic features</span>
<span class="c1"># authors: Sowmya Vajjala, Iowa State University, USA sowmya@iastate.edu</span>


<span class="c1"># based on french tagger from https://huggingface.co/qanastek/pos-french</span>
<span class="c1"># based on eng tagger from spacy</span>



<span class="c1">#TODO: morphologiser in spacy gibven info about tense used for VERB it can be added to the section of VERB</span>
<div class="viewcode-block" id="POSTagDensity"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.POSTagDensity">[docs]</a><span class="k">def</span> <span class="nf">POSTagDensity</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for density feature calculation. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list): A list of lists where each inner list represents [word, word.lemma, word.pos, word.tag]</span>

<span class="sd">    Returns:</span>
<span class="sd">    posFeatures (dict): Dictionary with the keys representing POS tag features and values as their calculated densities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># # Load the model</span>
    <span class="c1"># model = SequenceTagger.load(&quot;qanastek/pos-french&quot;)</span>
    <span class="c1"># # Create sentence object out of doc</span>
    <span class="c1"># sentence = Sentence(doc.text)</span>
    <span class="c1"># # Predict tags</span>
    <span class="c1"># prediction = model.predict(sentence)</span>
    <span class="c1"># # Split tagged object to get list of pairs word-tag</span>
    <span class="c1"># taggedText = sentence.to_tagged_string().split(&quot;→&quot;)[1].split(&quot;,&quot;)</span>

    <span class="c1"># List of features to be extracted</span>

    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">,</span> <span class="s1">&#39;numAdj&#39;</span><span class="p">,</span> <span class="s1">&#39;numNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numVerbs&#39;</span><span class="p">,</span> <span class="s1">&#39;numPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numConjunct&#39;</span><span class="p">,</span> <span class="s1">&#39;numProperNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numPrepositions&#39;</span><span class="p">,</span> <span class="s1">&#39;numAdverbs&#39;</span><span class="p">,</span> <span class="s1">&#39;numLexicals&#39;</span><span class="p">,</span> <span class="s1">&#39;numInterjections&#39;</span><span class="p">,</span> <span class="s1">&#39;perpronouns&#39;</span> <span class="p">,</span> <span class="s1">&#39;numFunctionWords&#39;</span><span class="p">,</span>  <span class="s1">&#39;numDeterminers&#39;</span><span class="p">,</span>  <span class="s1">&#39;numVB&#39;</span><span class="p">,</span> <span class="s1">&#39;numVBN&#39;</span><span class="p">,</span> <span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span>
    <span class="c1">#&#39;perpronouns&#39; : adding num Personal Pronouns with the hypothesis that they will occur more in Simple Sentences</span>
    <span class="c1">#&#39;whperpronouns&#39; : adding num Wh personal pronouns with the hypothesis that they will occur more in Normal sentences.</span>
    <span class="c1">#&#39;numFunctionWords&#39; : by Wiki: Articles, Pronouns, Conjunctions, Interjections, Prep, Adverbs, Aux - Verbs.</span>
    <span class="c1">#&#39;numTenses&#39; :  Number of different tenses in the sentence.Intuition: More tenses, more difficult to understand</span>
    <span class="n">uniqueVerbs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">typesTags</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">words</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">:</span>
        <span class="c1"># words = words.replace(&#39; &#39;, &#39;&#39;)</span>
        <span class="c1"># words = words.replace(&#39;\&quot;&#39;, &#39;&#39;)</span>
        <span class="c1"># words = words.replace(&#39;\\&#39;, &#39;&#39;)</span>
        <span class="c1"># # words.replace(str(\), &#39;&#39;)</span>
        <span class="c1"># words =  words.replace(&#39;[&#39;, &#39;&#39;)</span>
        <span class="c1"># words = words.split(&quot;/&quot;)</span>
        <span class="c1"># token_text = words[0]</span>
        <span class="c1"># token_tag = words[1]</span>

        <span class="n">token_text</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">text</span>
        <span class="n">token_tag</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">tag_</span>

        <span class="c1"># #print(token_text, &quot; &quot;, token_tag)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;PPER1S&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;PPER2S&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;PPER3MS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PPER3MP&quot;</span><span class="p">)</span><span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PPER3FS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PPER3FP&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;perpronouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># if (token_tag==&quot;WP&quot;):</span>
            <span class="c1">#     typesTags[&#39;whperpronouns&#39;] += 1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VERB&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPMP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPFS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPFP&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">token_text</span> <span class="ow">in</span> <span class="n">uniqueVerbs</span><span class="p">:</span>
                <span class="n">uniqueVerbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token_text</span><span class="p">)</span>
                <span class="c1">#TODO: if it has to calculate how many words were used only once then it is not working like that cause if the word is used the second time we are not updating this list to delete this word</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;VERB&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVB&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPMP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPFS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;VPPFP&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBN&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;ADJ&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;ADJMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;ADJMP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;ADJFS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;ADJFP&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span> <span class="s2">&quot;ADV&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PART&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PREP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;COSUB&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPrepositions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;INTJ&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numInterjections&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;COCO&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numConjunct&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;NMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;NMP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;NFS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;NFP&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;PROPN&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># if (token_tag==&quot;MD&quot;):</span>
        <span class="c1">#     typesTags[&#39;numModals&#39;] += 1</span>
        <span class="c1">#     typesTags[&#39;numauxverbs&#39;] += 1</span>
        <span class="c1">#     typesTags[&#39;numFunctionWords&#39;] += 1</span>
        <span class="c1">#     typesTags[&#39;TotalWords&#39;] += 1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;DET&quot;</span><span class="p">)</span>  <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;DETMS&quot;</span><span class="p">)</span>  <span class="ow">or</span> <span class="p">(</span><span class="n">token_tag</span><span class="o">==</span><span class="s2">&quot;DETFS&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numDeterminers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
    <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="c1">#Lex.Den = NumLexicals/TotalWords</span>
    <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span> <span class="c1">#- typesTags[&#39;numauxverbs&#39;]</span>

    <span class="n">listOfPOSTagFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;POS_numNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numProperNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numConjunct&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numAdjectives&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbs&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numAdverbs&#39;</span><span class="p">,</span>  <span class="s1">&#39;POS_numModals&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPrepositions&#39;</span><span class="p">,</span>  <span class="s1">&#39;POS_numInterjections&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPerPronouns&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numWhPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numLexicals&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numFunctionWords&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numDeterminers&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numVerbsVB&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBG&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBN&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBP&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBZ&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_advVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_adjVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_modVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_nounVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_verbVar1&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_verbVar2&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_squaredVerbVar1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_correctedVV1&#39;</span><span class="p">]</span>

    <span class="n">posFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfPOSTagFeatures</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numNouns&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numProperNouns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numPronouns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numConjunct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numConjunct&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numAdjectives&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numVerbs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numAdverbs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    
    
    <span class="c1"># posFeatures[&quot;POS_numModals&quot;] =  typesTags[&#39;numModals&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numPrepositions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPrepositions&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numInterjections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numInterjections&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numPerPronouns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;perpronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="c1"># posFeatures[&quot;POS_numWhPronouns&quot;] = typesTags[&#39;whperpronouns&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numLexicals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="c1">#Lexical Density</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numFunctionWords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numDeterminers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numDeterminers&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numVerbsVB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVB&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="c1"># posFeatures[&quot;POS_numVerbsVBD&quot;] = typesTags[&#39;numVBD&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    
    
    <span class="c1"># posFeatures[&quot;POS_numVerbsVBG&quot;] =  typesTags[&#39;numVBG&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_numVerbsVBN&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBN&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span>
    <span class="c1"># posFeatures[&quot;POS_numVerbsVBP&quot;] = typesTags[&#39;numVBP&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    <span class="c1"># posFeatures[&quot;POS_numVerbsVBZ&quot;] = typesTags[&#39;numVBZ&#39;] / typesTags[&#39;TotalWords&#39;]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_advVar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_adjVar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_modVar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_nounVar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_verbVar1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueVerbs</span><span class="p">)</span><span class="c1"># VV1</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_verbVar2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span> <span class="c1"># VV2</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_squaredVerbVar1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueVerbs</span><span class="p">)</span> <span class="c1"># VV1</span>
    <span class="n">posFeatures</span><span class="p">[</span><span class="s2">&quot;POS_correctedVV1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueVerbs</span><span class="p">))</span> <span class="c1"># CVV1</span>
    
    <span class="c1">#print(posFeatures)</span>
    <span class="k">return</span> <span class="n">posFeatures</span></div>



<div class="viewcode-block" id="POSTagForEng"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.POSTagForEng">[docs]</a><span class="k">def</span> <span class="nf">POSTagForEng</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for building mapping between POS Tag notations in French and English tagging. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list of spacy.Token): List of tokens where each token has attributes like `text`, `lemma_`, `pos_`, `tag_`.</span>

<span class="sd">    Returns:</span>
<span class="sd">    typesTags (dict): Dictionary with the keys of feature names and items values of the features for this document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">,</span> <span class="s1">&#39;numAdj&#39;</span><span class="p">,</span> <span class="s1">&#39;numNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numVerbs&#39;</span><span class="p">,</span> <span class="s1">&#39;numPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numConjunct&#39;</span><span class="p">,</span> <span class="s1">&#39;numProperNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numPrepositions&#39;</span><span class="p">,</span> <span class="s1">&#39;numAdverbs&#39;</span><span class="p">,</span> <span class="s1">&#39;numLexicals&#39;</span><span class="p">,</span> <span class="s1">&#39;numModals&#39;</span><span class="p">,</span> <span class="s1">&#39;numInterjections&#39;</span><span class="p">,</span> <span class="s1">&#39;perpronouns&#39;</span> <span class="p">,</span> <span class="s1">&#39;whperpronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numauxverbs&#39;</span><span class="p">,</span> <span class="s1">&#39;numFunctionWords&#39;</span><span class="p">,</span>  <span class="s1">&#39;numDeterminers&#39;</span><span class="p">,</span> <span class="s1">&#39;numTenses&#39;</span><span class="p">,</span>  <span class="s1">&#39;numVB&#39;</span><span class="p">,</span> <span class="s1">&#39;numVBD&#39;</span><span class="p">,</span><span class="s1">&#39;numVBG&#39;</span><span class="p">,</span> <span class="s1">&#39;numVBN&#39;</span><span class="p">,</span> <span class="s1">&#39;numVBP&#39;</span><span class="p">,</span> <span class="s1">&#39;numVBZ&#39;</span><span class="p">]</span>
    <span class="c1">#&#39;perpronouns&#39; : adding num Personal Pronouns with the hypothesis that they will occur more in Simple Sentences</span>
    <span class="c1">#&#39;whperpronouns&#39; : adding num Wh personal pronouns with the hypothesis that they will occur more in Normal sentences.</span>
    <span class="c1">#&#39;numFunctionWords&#39; : by Wiki: Articles, Pronouns, Conjunctions, Interjections, Prep, Adverbs, Aux - Verbs.</span>
    <span class="c1">#&#39;numTenses&#39; :  Number of different tenses in the sentence.Intuition: More tenses, more difficult to understand</span>
    <span class="n">uniqueVerbs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">typesTags</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="c1">#print(token.text, &quot; &quot;, token.tag_)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;PRP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;PRP$&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;WP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;WP$&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span>  <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;PRP&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;perpronouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;WP&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;whperpronouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VB&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VBD&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VBG&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VBN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VBP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;VBZ&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">uniqueVerbs</span><span class="p">:</span>
                <span class="n">uniqueVerbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VB&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVB&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VBD&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBD&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VBG&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBG&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VBN&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBN&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VBP&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBP&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;VBZ&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVBZ&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;JJ&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;JJR&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;JJS&quot;</span><span class="p">):</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;RB&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;RBR&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;RBS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;RP&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;IN&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numPrepositions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;UH&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numInterjections&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;CC&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numConjunct&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;NN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;NNS&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;NNP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;NNPS&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;MD&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numModals&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numauxverbs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span><span class="s2">&quot;DT&quot;</span><span class="p">):</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numFunctionWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numDeterminers&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;TotalWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numLexicals&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdj&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbs&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numAdverbs&#39;</span><span class="p">]</span><span class="o">+</span> <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="c1">#Lex.Den = NumLexicals/TotalWords</span>
    <span class="n">typesTags</span><span class="p">[</span><span class="s1">&#39;numVerbsOnly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numVerbs</span><span class="o">-</span><span class="n">numauxverbs</span>
    <span class="c1"># #print(typesTags)</span>

    <span class="k">return</span> <span class="n">typesTags</span></div>

<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Discourse features </span>
<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Those features are taken from article</span>
<span class="c1"># paper: Automated assessment of non-native learner essays: Investigating the role of linguistic features</span>
<span class="c1"># authors: Sowmya Vajjala, Iowa State University, USA sowmya@iastate.edu</span>

<span class="c1"># Code was taken from repository of: https://bitbucket.org/nishkalavallabhi/ijaiedpapercode/src/master/features/ContentOverlapFeatures.java</span>
<span class="c1"># Code was adapted fro python and fremch language using fr tagger</span>

<span class="c1"># TODO: because og automatic annotation there is no points thus no separation on sentences</span>

<div class="viewcode-block" id="getOverlapFeatures"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.getOverlapFeatures">[docs]</a><span class="k">def</span> <span class="nf">getOverlapFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function extracts overlap features between sentences in a document. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (list of list): List of sentences where each sentence is represented as a list of (text, lemma, pos, tag).</span>

<span class="sd">    Returns:</span>
<span class="sd">    overlapFeatures (dict): Dictionary with the keys of feature names and items values of the features for this document.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    doc = [</span>
<span class="sd">    [(&#39;The&#39;, &#39;the&#39;, &#39;DET&#39;, None), (&#39;cat&#39;, &#39;cat&#39;, &#39;NOUN&#39;, &#39;NCS&#39;)],</span>
<span class="sd">    [(&#39;The&#39;, &#39;the&#39;, &#39;DET&#39;, None), (&#39;dog&#39;, &#39;dog&#39;, &#39;NOUN&#39;, &#39;NCS&#39;)]</span>
<span class="sd">    ]</span>
<span class="sd">    overlap_features = getOverlapFeatures(doc)</span>
<span class="sd">    print(overlap_features)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># doc is given in format of [[list of (text, lemma, pos, tag)], ..., []]</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;localNounOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localArgumentOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localStemOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localContentWordOverlap&#39;</span><span class="p">,</span> <span class="s1">&#39;globalNounOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalArgumentOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalStemOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalContentWordOverlap&#39;</span><span class="p">]</span>
    <span class="n">overlapFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">totalSentencesSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">#denominator for local overlap features.</span>
    <span class="c1"># int totalPairsCount = 0; # Used as the denominator for global overlap features.</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSentencesSize</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">totalSentencesSize</span><span class="p">):</span>
            <span class="n">sentence1</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sentence2</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isThereNounOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localNounOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localArgumentOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalNounOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalArgumentOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">isThereArgumentOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localArgumentOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalArgumentOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">isThereStemOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalStemOverlapCount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">tempContentOverlap</span> <span class="o">=</span> <span class="n">contentWordOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)</span>
            <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;globalContentWordOverlap&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tempContentOverlap</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">overlapFeatures</span><span class="p">[</span><span class="s1">&#39;localContentWordOverlap&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tempContentOverlap</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">overlapFeatures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">overlapFeatures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlapFeatures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/</span> <span class="n">totalSentencesSize</span>

    <span class="k">return</span> <span class="n">overlapFeatures</span></div>


<div class="viewcode-block" id="isThereNounOverlap"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.isThereNounOverlap">[docs]</a><span class="k">def</span> <span class="nf">isThereNounOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there is noun overlap between two sentences.</span>

<span class="sd">    Noun overlap is defined by the presence of at least one noun appearing in both sentences.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    sentence1 (list): List of spaCy Token objects representing words in the first sentence.</span>
<span class="sd">    sentence2 (list): List of spaCy Token objects representing words in the second sentence.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if there is noun overlap, False otherwise.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    import spacy</span>
<span class="sd">    nlp = spacy.load(&#39;fr_core_news_sm&#39;)</span>
<span class="sd">    sentence1 = nlp(&quot;Il a acheté une voiture.&quot;)</span>
<span class="sd">    sentence2 = nlp(&quot;Elle a vendu la maison.&quot;)</span>
<span class="sd">    noun_overlap = isThereNounOverlap(sentence1, sentence2)</span>
<span class="sd">    print(&quot;Noun overlap:&quot;, noun_overlap)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence1</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">sentence2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="isThereStemOverlap"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.isThereStemOverlap">[docs]</a><span class="k">def</span> <span class="nf">isThereStemOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there is stem overlap between two sentences.</span>

<span class="sd">    Stem overlap is defined by:</span>
<span class="sd">    - Noun overlap: If at least one noun appears in both sentences.</span>
<span class="sd">    - Argument overlap: If at least one argument (noun or pronoun) appears in both sentences.</span>
<span class="sd">    - Stem (lemma) similarity: If at least one word&#39;s lemma in sentence1 matches with a word&#39;s lemma in sentence2.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    sentence1 (list): List of spaCy Token objects representing words in the first sentence.</span>
<span class="sd">    sentence2 (list): List of spaCy Token objects representing words in the second sentence.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if there is stem overlap, False otherwise.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    import spacy</span>
<span class="sd">    nlp = spacy.load(&#39;fr_core_news_sm&#39;)</span>
<span class="sd">    sentence1 = nlp(&quot;Il a acheté une voiture.&quot;)</span>
<span class="sd">    sentence2 = nlp(&quot;Elle a vendu la maison.&quot;)</span>
<span class="sd">    stem_overlap = isThereStemOverlap(sentence1, sentence2)</span>
<span class="sd">    print(&quot;Stem overlap:&quot;, stem_overlap)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isThereNounOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isThereArgumentOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># If there is a noun or argument overlap, there is obviously an argument overlap right? No need to test further.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">lemmaTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lemma_</span>
                <span class="n">posTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span>
                <span class="k">for</span> <span class="n">wordTemp</span> <span class="ow">in</span> <span class="n">sentence2</span><span class="p">:</span>
                    <span class="n">lemmaTemp2</span> <span class="o">=</span> <span class="n">wordTemp</span><span class="o">.</span><span class="n">lemma_</span>
                    <span class="n">posTemp2</span> <span class="o">=</span> <span class="n">wordTemp</span><span class="o">.</span><span class="n">pos_</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">lemmaTemp</span> <span class="o">==</span> <span class="n">lemmaTemp2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">posTemp2</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">posTemp</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">posTemp</span> <span class="o">==</span> <span class="s2">&quot;PRON&quot;</span><span class="p">)):</span>
                        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="isThereArgumentOverlap"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.isThereArgumentOverlap">[docs]</a><span class="k">def</span> <span class="nf">isThereArgumentOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there is argument overlap between two sentences.</span>

<span class="sd">    Argument overlap is defined by:</span>
<span class="sd">    - Noun overlap: If at least one noun appears in both sentences.</span>
<span class="sd">    - Pronoun overlap: If at least one pronoun appears in both sentences.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    sentence1 (list): List of spaCy Token objects representing words in the first sentence.</span>
<span class="sd">    sentence2 (list): List of spaCy Token objects representing words in the second sentence.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if there is argument overlap, False otherwise.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    import spacy</span>
<span class="sd">    nlp = spacy.load(&#39;fr_core_news_sm&#39;)</span>
<span class="sd">    sentence1 = nlp(&quot;Il a acheté une voiture.&quot;)</span>
<span class="sd">    sentence2 = nlp(&quot;Elle a vendu la maison.&quot;)</span>
<span class="sd">    argument_overlap = isThereArgumentOverlap(sentence1, sentence2)</span>
<span class="sd">    print(&quot;Argument overlap:&quot;, argument_overlap)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isThereNounOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="c1"># If there is a noun overlap, there is obviously an argument overlap right? No need to test further.</span>
    <span class="c1"># Check for pronoun overlap?</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;PRON&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">sentence2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;PRON&quot;</span><span class="p">):</span>
                    <span class="n">lemmaTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lemma_</span>
                    <span class="n">posTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span>
                    <span class="k">for</span> <span class="n">wordTemp</span> <span class="ow">in</span> <span class="n">sentence2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">lemmaTemp</span> <span class="o">==</span> <span class="n">wordTemp</span><span class="o">.</span><span class="n">lemma_</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">posTemp</span> <span class="o">==</span> <span class="n">wordTemp</span><span class="o">.</span><span class="n">pos_</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">posTemp</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>




<div class="viewcode-block" id="contentWordOverlap"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.contentWordOverlap">[docs]</a><span class="k">def</span> <span class="nf">contentWordOverlap</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the overlap of content words between two sentences.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    sentence1 (list): List of spaCy Token objects representing words in the first sentence.</span>
<span class="sd">    sentence2 (list): List of spaCy Token objects representing words in the second sentence.</span>

<span class="sd">    Returns:</span>
<span class="sd">    overlapsCount (int): Number of overlapping content words between the two sentences.</span>

<span class="sd">    Notes:</span>
<span class="sd">    Content words are considered based on their part-of-speech tags. Words tagged as &quot;PRON&quot; (pronouns) are excluded from overlap calculations.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    import spacy</span>
<span class="sd">    nlp = spacy.load(&#39;fr_core_news_sm&#39;)</span>
<span class="sd">    sentence1 = nlp(&quot;Ceci est une phrase en français.&quot;)</span>
<span class="sd">    sentence2 = nlp(&quot;Voici une autre phrase avec des mots similaires.&quot;)</span>
<span class="sd">    overlap_count = contentWordOverlap(sentence1, sentence2)</span>
<span class="sd">    print(&quot;Content word overlap:&quot;, overlap_count)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">overlapsCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Isn&#39;t this similar to cosine similarity between content-words?</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence1</span><span class="p">:</span>
        <span class="n">poscatTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">pos_</span>
        <span class="n">lemmaTemp</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lemma_</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">poscatTemp</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">poscatTemp</span> <span class="o">==</span> <span class="s2">&quot;PRON&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">word2</span> <span class="ow">in</span> <span class="n">sentence2</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lemmaTemp</span> <span class="o">==</span> <span class="n">word2</span><span class="o">.</span><span class="n">lemma_</span><span class="p">):</span>
                    <span class="n">overlapsCount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">overlapsCount</span></div>


<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Chains of references </span>
<span class="c1">#---------------------------------------------------------------------</span>


<div class="viewcode-block" id="getRefExpFeatures"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.getRefExpFeatures">[docs]</a><span class="k">def</span> <span class="nf">getRefExpFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function extracts referential features from a French document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (frenchDoc class object): Contains .docFull which is a list of lists [word, word.lemma, word.pos, word.tag]</span>

<span class="sd">    Returns:</span>
<span class="sd">    refExprFeatures (dict): Dictionary with feature names as keys and their values as extracted features for the document.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function calculates various referential features based on the document&#39;s linguistic annotations.</span>

<span class="sd">    Feature Keys:</span>
<span class="sd">    - &#39;DISC_RefExprPronounsPerNoun&#39;: Ratio of personal pronouns to nouns in the document.</span>
<span class="sd">    - &#39;DISC_RefExprPronounsPerSen&#39;: Ratio of personal pronouns to sentences in the document.</span>
<span class="sd">    - &#39;DISC_RefExprPronounsPerWord&#39;: Ratio of personal pronouns to total words in the document.</span>
<span class="sd">    - &#39;DISC_RefExprPerPronounsPerSen&#39;: Ratio of personal pronouns (excluding possessive pronouns) to sentences.</span>
<span class="sd">    - &#39;DISC_RefExprPerProPerWord&#39;: Ratio of personal pronouns (excluding possessive pronouns) to total words.</span>
<span class="sd">    - &#39;DISC_RefExprPossProPerSen&#39;: Ratio of possessive pronouns to sentences.</span>
<span class="sd">    - &#39;DISC_RefExprPossProPerWord&#39;: Ratio of possessive pronouns to total words.</span>
<span class="sd">    - &#39;DISC_RefExprDefArtPerSen&#39;: Ratio of definite articles to sentences.</span>
<span class="sd">    - &#39;DISC_RefExprDefArtPerWord&#39;: Ratio of definite articles to total words.</span>
<span class="sd">    - &#39;DISC_RefExprProperNounsPerNoun&#39;: Ratio of proper nouns to nouns.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    doc = frenchDoc(...)  # Initialize frenchDoc object</span>
<span class="sd">    ref_features = getRefExpFeatures(doc)</span>
<span class="sd">    print(ref_features)</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">listOfCounters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">,</span> <span class="s1">&#39;numSentences&#39;</span><span class="p">,</span> <span class="s1">&#39;numPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numPersonalPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numPossessivePronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numDefiniteArticles&#39;</span><span class="p">,</span> <span class="s1">&#39;numProperNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;numNouns&#39;</span><span class="p">]</span>
    <span class="n">refExprCounters</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfCounters</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numSentences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">wordtagpair</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">wordtagpair</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">wordtagpair</span><span class="o">.</span><span class="n">tag_</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;DET&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;DETMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;DETFS&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">==</span> <span class="s2">&quot;the&quot;</span><span class="p">):</span>
                    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numDefiniteArticles&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER1S&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER2S&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER3MS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER3MP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER3FS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PPER3FP&quot;</span><span class="p">):</span>
                    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPersonalPronouns&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PRP$&quot;</span><span class="p">):</span> <span class="c1">#TODO: not sure in my tagger this exists but there is Demonstrative Pronoun</span>
                    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPossessivePronouns&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;NMS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;NMP&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;NFS&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;NFP&quot;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PROPN&quot;</span><span class="p">):</span>
                    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPersonalPronouns&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPossessivePronouns&#39;</span><span class="p">]</span>

    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DISC_RefExprPronounsPerNoun&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPronounsPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPronounsPerWord&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprPerPronounsPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPerProPerWord&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprPossProPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPossProPerWord&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprDefArtPerSen&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprDefArtPerWord&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprProperNounsPerNoun&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPronounsPerNoun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPronounsPerSen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numSentences&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPronounsPerWord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPerPronounsPerSen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPersonalPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numSentences&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPerProPerWord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPersonalPronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPossProPerSen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPossessivePronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numSentences&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprPossProPerWord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numPossessivePronouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprDefArtPerSen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numDefiniteArticles&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numSentences&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprDefArtPerWord&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numDefiniteArticles&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numWords&#39;</span><span class="p">]</span>
    <span class="n">refExprFeatures</span><span class="p">[</span><span class="s2">&quot;DISC_RefExprProperNounsPerNoun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numProperNouns&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">refExprCounters</span><span class="p">[</span><span class="s1">&#39;numNouns&#39;</span><span class="p">]</span>


    <span class="k">return</span> <span class="n">refExprFeatures</span></div>



<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Stuttering </span>
<span class="c1">#---------------------------------------------------------------------</span>

<span class="c1"># TODO: problems of french language: </span>
<span class="c1"># 1) reflexive verbs, example: il se sent bien ---&gt; se -- prefix of sent BUT it is not stuttering </span>
<span class="c1"># 2) acticles, example: je sais que un univers ... ---&gt; un -- prefix of univers</span>
<span class="c1"># 3) other, example: je sais que quelque ... ---&gt; que -- prefix of quelque</span>

<div class="viewcode-block" id="isPrefix"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.isPrefix">[docs]</a><span class="k">def</span> <span class="nf">isPrefix</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if word1 is a prefix of word2.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    word1 (str): The potential prefix.</span>
<span class="sd">    word2 (str): The word to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if word1 is a prefix of word2, False otherwise.</span>

<span class="sd">    Example:</span>
<span class="sd">    Calling `isPrefix(&quot;pre&quot;, &quot;prefix&quot;)` will return True since &quot;pre&quot; is a prefix of &quot;prefix&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">word1</span> <span class="o">==</span> <span class="n">word2</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">word1</span><span class="p">)]):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="hasStutterPrefix"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.hasStutterPrefix">[docs]</a><span class="k">def</span> <span class="nf">hasStutterPrefix</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a word has a stuttering prefix.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    word (str): The word to check for stuttering prefixes.</span>

<span class="sd">    Returns:</span>
<span class="sd">    bool: True if the word has a stuttering prefix, False otherwise.</span>

<span class="sd">    Notes:</span>
<span class="sd">    A stuttering prefix is considered present if a substring of the word up to a certain length appears within the remaining part of the word.</span>

<span class="sd">    Example:</span>
<span class="sd">    Calling `hasStutterPrefix(&quot;example&quot;)` will return True if the word &quot;example&quot; has any repeating prefix, otherwise False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1">#print(word[:i], &#39; &#39;, word[i:])</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">:]:</span>
            <span class="k">return</span> <span class="kc">True</span>
         
    
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="stutterFeatures"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.stutterFeatures">[docs]</a><span class="k">def</span> <span class="nf">stutterFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts stutter features from a document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (frenchDoc class object): Document object containing attributes like .docFull, which is a list of lists [word, word.lemma, word.pos, word.tag].</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: Dictionary with the keys representing feature names and values as the corresponding feature values for this document.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function computes stutter-related features based on word repetitions and structure within the document.</span>

<span class="sd">    Example:</span>
<span class="sd">    Given a `doc` object of type `frenchDoc`, calling `stutterFeatures(doc)` will return a dictionary</span>
<span class="sd">    containing features such as &#39;stutterToSent&#39;, &#39;stutterToWords&#39;, &#39;stutterStart&#39;, &#39;stutterMiddle&#39;, &#39;stutterEnd&#39;,</span>
<span class="sd">    &#39;stutterNum&#39;, &#39;stutterFirstThird&#39;, &#39;stutterSecondThird&#39;, and &#39;stutterThirdThird&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#print(doc.text)</span>
    <span class="c1">#print([token.tag_ for token in doc.docFull])</span>

    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stutterToSent&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterToWords&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterStart&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterMiddle&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterEnd&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterNum&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterFirstThird&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterSecondThird&#39;</span><span class="p">,</span> <span class="s1">&#39;stutterThirdThird&#39;</span><span class="p">]</span>
    <span class="n">stutterFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">docLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">)</span>
    <span class="n">docThird</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">docLen</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">curToken</span> <span class="o">=</span> <span class="mi">0</span>

    
    <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">:</span>
        <span class="n">sentLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
        <span class="n">thirdLen</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sentLen</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sent</span><span class="p">):</span>
            <span class="c1"># #print(token, i)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">isPrefix</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">sent</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;PUNCT&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">hasStutterPrefix</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())):</span>
                    <span class="c1">#print(&quot;is prefix:  &quot;, isPrefix(token.text.lower(), sent[i+1].text.lower()), &quot;hasStutter: &quot;, hasStutterPrefix(token.text.lower()), &#39;\n&#39; )</span>
                    <span class="c1">#print(&quot;currentToken: &quot;, token.text, &quot;nextOne: &quot;, sent[i+1].text , &#39;\n&#39;)</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">thirdLen</span><span class="p">):</span>
                        <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterStart&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">thirdLen</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">thirdLen</span><span class="p">):</span>
                        <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterMiddle&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterEnd&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>



    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">docLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isPrefix</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="o">==</span> <span class="s2">&quot;PUNCT&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">hasStutterPrefix</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())):</span>
                <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterNum&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1">#print(&quot;is prefix:  &quot;, isPrefix(token.text.lower(), doc.docFull[i+1].text.lower()), &quot;hasStutter: &quot;, hasStutterPrefix(token.text.lower()), &#39;\n&#39; )</span>
                <span class="c1">#print(&quot;currentToken: &quot;, token.text, &quot;nextOne: &quot;, doc.docFull[i+1].text , &#39;\n&#39;)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">curToken</span> <span class="o">&lt;=</span> <span class="n">docThird</span><span class="p">):</span>
                    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterFirstThird&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">docThird</span> <span class="o">&lt;</span> <span class="n">curToken</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curToken</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">docThird</span><span class="p">):</span>
                    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterSecondThird&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterThirdThird&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    

                
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterToSent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterNum&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterToWords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterNum&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">docLen</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterStart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterStart&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterMiddle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterMiddle&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterEnd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterEnd&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterFirstThird&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterFirstThird&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">docThird</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterSecondThird&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterSecondThird&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">docThird</span>
    <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterThirdThird&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stutterFeatures</span><span class="p">[</span><span class="s1">&#39;stutterThirdThird&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">docThird</span>

    <span class="c1">#print(stutterFeatures)</span>
    <span class="k">return</span> <span class="n">stutterFeatures</span></div>



<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Embeddings extraction</span>
<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># based on Doc2Vec pretrained on Wiki </span>
<span class="c1"># TODO: check training data, maybe re-train the model on more apropriative data</span>


<div class="viewcode-block" id="embeddingExtraction"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.embeddingExtraction">[docs]</a><span class="k">def</span> <span class="nf">embeddingExtraction</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts document embeddings using a pre-trained Doc2Vec model.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (object): Document object containing text to be embedded.</span>

<span class="sd">    Returns:</span>
<span class="sd">    np.ndarray: Extracted document embedding as a numpy array.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function uses a pre-trained Doc2Vec model to infer embeddings for the input document text.</span>

<span class="sd">    Example:</span>
<span class="sd">    Given a `doc` object with text, calling `embeddingExtraction(doc)` will return a numpy array</span>
<span class="sd">    representing the document embedding.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># parameters</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;../demo/&quot;</span> <span class="o">+</span> <span class="n">dataset</span> <span class="o">+</span> <span class="s2">&quot;/model.bin&quot;</span>
    <span class="c1"># test_docs=&quot;toy_data/test_docs.txt&quot;</span>
    <span class="c1"># output_file = &quot;./test_vectors.txt&quot;</span>

    <span class="c1"># inference hyper-parameters</span>
    <span class="n">start_alpha</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">infer_epoch</span> <span class="o">=</span> <span class="mi">1000</span>

    <span class="c1"># load Doc2Vec model</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">Doc2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># Build a sample cloud</span>
    <span class="n">sample_cloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">infer_vector</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">start_alpha</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">infer_epoch</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sample_cloud</span></div>




<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Ratio-based features</span>
<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># TODO: merge this with the new word based features from article </span>

<div class="viewcode-block" id="extractLinkingRate"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.extractLinkingRate">[docs]</a><span class="k">def</span> <span class="nf">extractLinkingRate</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts linking rate features from a document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (frenchDoc class object): Document object containing attributes like .docFull, which is a list of lists [word, word.lemma, word.pos, word.tag].</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: Dictionary with keys representing feature names and values as the corresponding feature values for the document.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function computes linking rate features based on conjunctions and sentence structure in the document.</span>

<span class="sd">    Example:</span>
<span class="sd">    Given a `doc` object of type `frenchDoc`, calling `extractLinkingRate(doc)` will return a dictionary</span>
<span class="sd">    containing features such as &#39;conjunctToSent&#39;, &#39;conjunctTypesToSent&#39;, &#39;conjunctToWords&#39;, &#39;conjunctNum&#39;,</span>
<span class="sd">    &#39;conjunctTypesToTotal&#39;, and &#39;conjunctNeighborSent&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conjunctToSent&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctTypesToSent&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctToWords&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctNum&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctTypesToTotal&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctNeighborSent&#39;</span><span class="p">]</span>
    <span class="n">conjunctFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">nbSent</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
    <span class="n">docLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">)</span>

    <span class="n">conjunction</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">:</span>
        <span class="c1"># #print(token.pos_)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;CONJ&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;CCONJ&quot;</span><span class="p">):</span>
            <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNum&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">conjunction</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">conjunction</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conjunction</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
   
    <span class="k">for</span> <span class="n">curSent</span><span class="p">,</span> <span class="n">sent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curSent</span> <span class="o">&lt;</span> <span class="n">nbSent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">[</span><span class="n">curSent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNeighborSent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNum&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctTypesToTotal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conjunction</span><span class="p">)</span> <span class="o">/</span> <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNum&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctTypesToTotal&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mi">0</span>

    <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctToSent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNum&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">nbSent</span>
    <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctTypesToSent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conjunction</span><span class="p">)</span><span class="o">/</span><span class="n">nbSent</span>
    <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctToWords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNum&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">docLen</span>
    <span class="n">conjunctFeatures</span><span class="p">[</span><span class="s1">&#39;conjunctNeighborSent&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nbSent</span>

    <span class="k">return</span> <span class="n">conjunctFeatures</span></div>


<span class="c1"># TODO: optimise code to not to have doubled code for NOUN &amp; VOERB</span>
<span class="c1"># TODO: calculate the time of calculations and check if possible to optimise</span>
<span class="c1"># TODO: sameRootRate features </span>
<div class="viewcode-block" id="extractSynonymsRate"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.extractSynonymsRate">[docs]</a><span class="k">def</span> <span class="nf">extractSynonymsRate</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts synonym rate features from a document.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (frenchDoc class object): Document object containing attributes like .docFull, which is a list of lists [word, word.lemma, word.pos, word.tag].</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: Dictionary with keys representing feature names and values as the corresponding feature values for the document.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function computes synonym rates for nouns and verbs based on WordNet synonyms in French.</span>

<span class="sd">    Example:</span>
<span class="sd">    Given a `doc` object of type `frenchDoc`, calling `extractSynonymsRate(doc)` will return a dictionary</span>
<span class="sd">    containing features such as &#39;synonymToNouns&#39;, &#39;synonymToVerbs&#39;, &#39;averageSynClassNOUN&#39;, and &#39;averageSynClassVERB&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">listOfFeatures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;synonymToNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;synonymToVerbs&#39;</span><span class="p">,</span> <span class="s1">&#39;averageSynClassNOUN&#39;</span><span class="p">,</span> <span class="s1">&#39;averageSynClassVERB&#39;</span><span class="p">]</span>
    <span class="n">synonymsFeatures</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">listOfFeatures</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># dicts for NOUNS</span>
    <span class="n">goupsDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">nbOfGroups</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">token_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roots_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">allNouns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># dicts for verbs</span>
    <span class="n">goupsDictVERB</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">nbOfGroupsVERB</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">token_dictVERB</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roots_dictVERB</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">allVerbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">):</span>
            <span class="n">allNouns</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;VERB&quot;</span><span class="p">):</span>
            <span class="n">allVerbs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nbOfNouns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">allNouns</span><span class="p">)</span>
    <span class="n">nbOfVerbs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">allVerbs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">roots_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">roots_dict</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">token_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">synsets</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">lang</span> <span class="o">=</span> <span class="s1">&#39;fra&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">syn</span><span class="o">.</span><span class="n">lemma_names</span><span class="p">(</span><span class="s1">&#39;fra&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">token_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">goupsDict</span><span class="p">[</span><span class="n">token_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">token_dict</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">token_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">token_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">bool</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nbOfGroups</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">goupsDict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nbOfGroups</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">token_dict</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbOfGroups</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;VERB&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">roots_dictVERB</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">roots_dictVERB</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">token_dictVERB</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">wordnet</span><span class="o">.</span><span class="n">synsets</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">lang</span> <span class="o">=</span> <span class="s1">&#39;fra&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">syn</span><span class="o">.</span><span class="n">lemma_names</span><span class="p">(</span><span class="s1">&#39;fra&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">token_dictVERB</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">goupsDictVERB</span><span class="p">[</span><span class="n">token_dictVERB</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">token_dictVERB</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">token_dictVERB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">token_dictVERB</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">bool</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nbOfGroupsVERB</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">goupsDictVERB</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nbOfGroupsVERB</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">token_dictVERB</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbOfGroupsVERB</span><span class="p">)</span>

    <span class="n">synonymsFeatures</span><span class="p">[</span><span class="s1">&#39;synonymToNouns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbOfGroups</span> <span class="o">/</span> <span class="n">nbOfNouns</span>
    <span class="n">synonymsFeatures</span><span class="p">[</span><span class="s1">&#39;averageSynClassNOUN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">goupsDict</span><span class="p">[</span><span class="n">volume</span><span class="p">])</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">goupsDict</span><span class="p">])</span><span class="o">/</span><span class="n">nbOfGroups</span>
    <span class="n">synonymsFeatures</span><span class="p">[</span><span class="s1">&#39;synonymToVerbs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbOfGroupsVERB</span> <span class="o">/</span> <span class="n">nbOfVerbs</span>
    <span class="n">synonymsFeatures</span><span class="p">[</span><span class="s1">&#39;averageSynClassVERB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">goupsDictVERB</span><span class="p">[</span><span class="n">volume</span><span class="p">])</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">goupsDictVERB</span><span class="p">])</span><span class="o">/</span><span class="n">nbOfGroupsVERB</span>

    <span class="k">return</span> <span class="n">synonymsFeatures</span></div>








<span class="c1">#---------------------------------------------------------------------</span>
<span class="c1"># Extract all features and provide to the TextProcess()</span>
<span class="c1">#---------------------------------------------------------------------</span>

<div class="viewcode-block" id="extractTextFeatures"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.extractTextFeatures">[docs]</a><span class="k">def</span> <span class="nf">extractTextFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts linguistic features from the document based on language-specific processing.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    doc (object): Document object containing text and metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">    list: List of feature dictionaries extracted from the document.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function performs feature extraction based on the language of the document.</span>
<span class="sd">    If the language is French (&#39;french&#39;), it extracts features related to linking rate,</span>
<span class="sd">    synonym rate, lexical diversity, POS tag density, discourse features, and referential</span>
<span class="sd">    expression features. English language processing is not currently supported.</span>

<span class="sd">    Example:</span>
<span class="sd">    Given a document `doc`, calling `extractTextFeatures(doc)` will return a list of dictionaries</span>
<span class="sd">    containing linguistic features extracted from the document.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">):</span>
        <span class="c1"># Linking Rate feature extraction</span>
        <span class="n">features_linking_rate</span> <span class="o">=</span> <span class="n">extractLinkingRate</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="c1"># Synonym Rate feature extraction</span>
        <span class="n">features_synonyms_rate</span> <span class="o">=</span> <span class="n">extractSynonymsRate</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="c1"># Diversity feature extraction</span>
        <span class="n">features_diversity</span> <span class="o">=</span> <span class="n">lexicalDiversity</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docFull</span><span class="p">)</span>
        <span class="c1"># Density feature extraction</span>
        <span class="n">features_density</span> <span class="o">=</span> <span class="n">POSTagDensity</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="c1"># Discourse feature extraction</span>
        <span class="n">features_discourse</span>  <span class="o">=</span> <span class="n">getOverlapFeatures</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">docPerSent</span><span class="p">)</span>
        <span class="c1"># Referencial feature extraction</span>
        <span class="n">features_reference</span> <span class="o">=</span> <span class="n">getRefExpFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;English version of tagging etraction is not concistent with french one&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">features_linking_rate</span><span class="p">,</span> <span class="n">features_synonyms_rate</span><span class="p">,</span> <span class="n">features_diversity</span><span class="p">,</span> <span class="n">features_density</span><span class="p">,</span> <span class="n">features_reference</span><span class="p">,</span> <span class="n">features_discourse</span><span class="p">]</span></div>



<div class="viewcode-block" id="createFeatureLists"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.createFeatureLists">[docs]</a><span class="k">def</span> <span class="nf">createFeatureLists</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a dictionary of feature names categorized by feature types.</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: Dictionary where keys are category names and values are lists of feature names.</span>

<span class="sd">    Example:</span>
<span class="sd">    The returned dictionary structure:</span>
<span class="sd">    {</span>
<span class="sd">    &#39;LinkingRate&#39;: [&#39;category&#39;, &#39;conjunctToSent&#39;, &#39;conjunctTypesToSent&#39;, &#39;conjunctToWords&#39;, &#39;conjunctNum&#39;, &#39;conjunctTypesToTotal&#39;, &#39;conjunctNeighborSent&#39;],</span>
<span class="sd">    &#39;SynonymRate&#39;: [&#39;category&#39;, &#39;synonymToNouns&#39;, &#39;synonymToVerbs&#39;, &#39;averageSynClassNOUN&#39;, &#39;averageSynClassVERB&#39;],</span>
<span class="sd">    &#39;featureEmbedName&#39;: [&#39;category&#39;, &#39;emb_axis_0&#39;, &#39;emb_axis_1&#39;, ..., &#39;emb_axis_99&#39;],</span>
<span class="sd">    &#39;Diversity&#39;: [&#39;category&#39;, &#39;TTR&#39;, &#39;CorrectedTTR&#39;, &#39;RootTTR&#39;, &#39;BilogTTR&#39;, &#39;MTLD&#39;],</span>
<span class="sd">    &#39;Density&#39;: [&#39;category&#39;, &#39;POS_numNouns&#39;, &#39;POS_numProperNouns&#39;, &#39;POS_numPronouns&#39;, &#39;POS_numConjunct&#39;, ...],</span>
<span class="sd">    &#39;Discourse&#39;: [&#39;category&#39;, &#39;localNounOverlapCount&#39;, &#39;localArgumentOverlapCount&#39;, &#39;localStemOverlapCount&#39;, ...],</span>
<span class="sd">    &#39;Reference&#39;: [&#39;category&#39;, &#39;DISC_RefExprPronounsPerNoun&#39;, &#39;DISC_RefExprPronounsPerSen&#39;, &#39;DISC_RefExprPronounsPerWord&#39;, ...]</span>
<span class="sd">    }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ceategoryDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LinkingRate&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctToSent&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctTypesToSent&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctToWords&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctNum&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctTypesToTotal&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunctNeighborSent&#39;</span><span class="p">]</span>
                     <span class="p">,</span> <span class="s1">&#39;SynonymRate&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;synonymToNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;synonymToVerbs&#39;</span><span class="p">,</span> <span class="s1">&#39;averageSynClassNOUN&#39;</span><span class="p">,</span> <span class="s1">&#39;averageSynClassVERB&#39;</span><span class="p">]</span>
                     <span class="p">,</span> <span class="s1">&#39;featureEmbedName&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;emb_axis_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
                     <span class="p">,</span> <span class="s1">&#39;Diversity&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;TTR&#39;</span><span class="p">,</span> <span class="s1">&#39;CorrectedTTR&#39;</span><span class="p">,</span> <span class="s1">&#39;RootTTR&#39;</span><span class="p">,</span> <span class="s1">&#39;BilogTTR&#39;</span><span class="p">,</span> <span class="s1">&#39;MTLD&#39;</span><span class="p">]</span>
                     <span class="p">,</span> <span class="s1">&#39;Density&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;POS_numNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numProperNouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numConjunct&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numAdjectives&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbs&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numAdverbs&#39;</span><span class="p">,</span>  <span class="s1">&#39;POS_numModals&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPrepositions&#39;</span><span class="p">,</span>  <span class="s1">&#39;POS_numInterjections&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numPerPronouns&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numWhPronouns&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numLexicals&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numFunctionWords&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numDeterminers&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_numVerbsVB&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBG&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBN&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBP&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_numVerbsVBZ&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_advVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_adjVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_modVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_nounVar&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_verbVar1&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_verbVar2&#39;</span><span class="p">,</span> <span class="s1">&#39;POS_squaredVerbVar1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;POS_correctedVV1&#39;</span><span class="p">]</span>
                    <span class="p">,</span> <span class="s1">&#39;Discourse&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;localNounOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localArgumentOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localStemOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;localContentWordOverlap&#39;</span><span class="p">,</span> <span class="s1">&#39;globalNounOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalArgumentOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalStemOverlapCount&#39;</span><span class="p">,</span> <span class="s1">&#39;globalContentWordOverlap&#39;</span><span class="p">]</span>
                    <span class="p">,</span> <span class="s1">&#39;Reference&#39;</span><span class="p">:[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprPronounsPerNoun&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPronounsPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPronounsPerWord&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprPerPronounsPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPerProPerWord&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprPossProPerSen&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprPossProPerWord&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprDefArtPerSen&#39;</span><span class="p">,</span><span class="s1">&#39;DISC_RefExprDefArtPerWord&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC_RefExprProperNounsPerNoun&#39;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ceategoryDict</span></div>



<div class="viewcode-block" id="french_to_english_text"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.french_to_english_text">[docs]</a><span class="k">def</span> <span class="nf">french_to_english_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates French accented characters to their English counterparts in the text.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    text (str): Text containing French accented characters.</span>

<span class="sd">    Returns:</span>
<span class="sd">    str: Translated text with French characters replaced by their English equivalents.</span>

<span class="sd">    Example:</span>
<span class="sd">    If `text = &quot;école et théâtre&quot;`, the function will return `&quot;ecole et theatre&quot;`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">french_to_english</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;é&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;á&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;à&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;â&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;ç&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;é&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;è&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;ê&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;ë&#39;</span><span class="p">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;î&#39;</span><span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;ï&#39;</span><span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;ô&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;ù&#39;</span><span class="p">:</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;û&#39;</span><span class="p">:</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;ç&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,}</span>
    <span class="n">translated_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">translated_text</span> <span class="o">+=</span> <span class="n">french_to_english</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">translated_text</span></div>

<div class="viewcode-block" id="sanitize_filename"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.sanitize_filename">[docs]</a><span class="k">def</span> <span class="nf">sanitize_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans the filename by removing specified special characters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    filename (str): Name of the file or directory to be sanitized.</span>

<span class="sd">    Returns:</span>
<span class="sd">    str: Sanitized filename without spaces, dashes, underscores, or commas.</span>

<span class="sd">    Example:</span>
<span class="sd">    If `filename = &quot;my - file_name, with spaces.csv&quot;`, the function will return</span>
<span class="sd">    `&quot;myfilenamewithspaces.csv&quot;`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Example: Remove spaces and special characters</span>
    <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TextProcess"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.TextProcess">[docs]</a><span class="k">def</span> <span class="nf">TextProcess</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function that reads .txt files from the directory with transcripts and </span>
<span class="sd">    executes feature extraction. Transcript directory should contain subfolders: </span>
<span class="sd">    full, beg, mid, end. Transcripts are named with the ID in the dataset.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    rootDirPath (str): Root directory path where data is stored.</span>
<span class="sd">    dataset (str): Name of the dataset.</span>
<span class="sd">    clip (str or int, optional): Specifies the subfolder(s) to process. Default is &quot;all&quot;.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    None</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function reads text files (.txt) from subdirectories of the transcript directory,</span>
<span class="sd">    extracts linguistic features from each file, and saves the results to CSV files categorized</span>
<span class="sd">    by feature type (e.g., linkingRate.csv, diversity.csv).</span>

<span class="sd">    Example:</span>
<span class="sd">    If `rootDirPath=&#39;/path/to/root&#39;`, `dataset=&#39;example_dataset&#39;`, and `clip=&#39;all&#39;`,</span>
<span class="sd">    it will process all subfolders (&#39;full&#39;, &#39;beg&#39;, &#39;mid&#39;, &#39;end&#39;) in</span>
<span class="sd">    &#39;/path/to/root/data/example_dataset/transcripts&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Data directory</span>
    <span class="n">data_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootDirPath</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
    <span class="c1"># Transcript directory</span>
    <span class="n">transcript_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;transcripts&quot;</span><span class="p">)</span>
    <span class="c1"># Create the list of clips interesting for the analysis</span>
    <span class="k">if</span> <span class="n">clip</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">subdir_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;beg&#39;</span><span class="p">,</span> <span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subdir_list</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">clip</span><span class="p">)]</span>
    <span class="c1"># Go through the subdirectories to read the .txt files and extract features</span>
    <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">subdir_list</span><span class="p">:</span> 
        <span class="c1"># Create a psth of subdirectory subtaining the .txt files corresponding to the clip</span>
        <span class="n">subdir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">transcript_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
        <span class="c1"># Create the dictionary of the features of each category</span>
        <span class="n">ceategoryDict</span> <span class="o">=</span> <span class="n">createFeatureLists</span><span class="p">()</span>
        <span class="c1"># Go throug the directory {rootDir}/data/{dataset}/transcripts/{subdir}</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">subdir_path</span><span class="p">):</span>
            <span class="c1"># Check whether the found file is .txt</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">):</span>
                <span class="c1"># Remove .txt extension and sub-directory prefix to get ID of the file </span>
                <span class="n">cleaned_name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="c1"># Create POSTagging for the .txt file</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">text2sentence</span><span class="p">(</span><span class="n">transcript_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="c1"># Extract textual features. This outputs the list of lists. </span>
                <span class="c1"># Each list corresponds to the feature category and aligned with ceategoryDict and featureCategories.</span>
                <span class="n">featureLists</span> <span class="o">=</span> <span class="n">extractTextFeatures</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="c1"># Go through each category list</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">features_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">featureLists</span><span class="p">):</span>
                    <span class="c1"># Create the new line for the feature .csv file out of the features extracted from the new document</span>
                    <span class="n">new_data_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">cleaned_name</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">features_list</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="c1"># Data directory for saving textual features</span>
                    <span class="n">feature_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;lingustic_features&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureCategories</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
                    <span class="c1"># Try to open .csv with features of the considered category </span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">feature_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">features_list</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="c1"># Otherwise create the new dataset</span>
                        <span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="c1"># Add and save the new line to the features of the category </span>
                    <span class="n">df_features</span> <span class="o">=</span> <span class="n">df_features</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">new_data_row</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">ceategoryDict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">featureCategories</span><span class="p">[</span><span class="n">idx</span><span class="p">])],</span> <span class="n">index</span><span class="o">=</span><span class="n">cleaned_name</span><span class="p">))</span>
                    <span class="n">df_features</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">feature_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span></div>
                    



<div class="viewcode-block" id="readMeta"><a class="viewcode-back" href="../../modules.html#preprocess.TextProcessor_MT.readMeta">[docs]</a><span class="k">def</span> <span class="nf">readMeta</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads metadata from a CSV file associated with the dataset.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    rootDirPath (str): Root directory path where data is stored.</span>
<span class="sd">    dataset (str): Name of the dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">    str: Language associated with the dataset as specified in the metadata.</span>

<span class="sd">    Notes:</span>
<span class="sd">    This function assumes the metadata CSV file is named &#39;{dataset}_meta_data.csv&#39;</span>
<span class="sd">    and is located in &#39;{rootDirPath}/data/{dataset}/&#39;.</span>

<span class="sd">    Example:</span>
<span class="sd">    If `rootDirPath=&#39;/path/to/root&#39;` and `dataset=&#39;example_dataset&#39;`,</span>
<span class="sd">    it reads metadata from &#39;/path/to/root/data/example_dataset/example_dataset_meta_data.csv&#39;</span>
<span class="sd">    and returns the language specified in the &#39;language&#39; column of the metadata.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Data directory</span>
    <span class="n">data_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootDirPath</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="o">+</span><span class="s2">&quot;_meta_data.csv&quot;</span><span class="p">)</span>
    <span class="c1"># Read metadata</span>
    <span class="n">meta_data</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
    <span class="c1"># Take language from metadata</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span></div>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entry point of the script for processing text data and extracting linguistic features.</span>
<span class="sd">    </span>
<span class="sd">    Dependencies:</span>
<span class="sd">    - nltk: Natural Language Toolkit for text processing tasks.</span>
<span class="sd">    </span>
<span class="sd">    Functionality:</span>
<span class="sd">    1. Downloads necessary NLTK resources: Punkt, WordNet, and Open Multilingual WordNet.</span>
<span class="sd">    2. Sets up feature categories for linguistic feature extraction.</span>
<span class="sd">    3. Reads configuration settings using `read_config()` function.</span>
<span class="sd">    4. Prints and uses configuration values like root directory path, dataset name, dimensions, and clip.</span>
<span class="sd">    5. Modifies system path to include root directory path for module imports.</span>
<span class="sd">    6. Reads metadata about the dataset using `readMeta()` function.</span>
<span class="sd">    7. Processes text data using `TextProcess()` function for feature extraction.</span>

<span class="sd">    Example:</span>
<span class="sd">    If `config[&#39;rootDirPath&#39;] = &#39;/path/to/root&#39;`, `config[&#39;dataset&#39;] = &#39;example_dataset&#39;`, </span>
<span class="sd">    and `config[&#39;clip&#39;] = &#39;all&#39;`, the script will download necessary NLTK resources,</span>
<span class="sd">    set up feature categories, read configuration values, and process text data from</span>
<span class="sd">    &#39;/path/to/root/data/example_dataset/&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Functionality: Punkt is a pre-trained tokenizer that helps in dividing </span>
    <span class="c1">#                a text into a list of sentences or words. It&#39;s crucial for tasks that </span>
    <span class="c1">#                require text preprocessing, such as sentence segmentation and word tokenization.</span>
    <span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt&#39;</span><span class="p">)</span>

    <span class="c1"># Functionality: WordNet is a large lexical database of English that groups words into </span>
    <span class="c1">#               sets of synonyms called synsets. It provides short definitions and usage </span>
    <span class="c1">#               examples, and it is widely used for tasks like word sense disambiguation, </span>
    <span class="c1">#               text analysis, and natural language understanding.</span>
    <span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;wordnet&#39;</span><span class="p">)</span>

    <span class="c1"># Functionality: The Open Multilingual WordNet provides translations of the English WordNet</span>
    <span class="c1">#                synsets into various other languages. This resource is useful for </span>
    <span class="c1">#                multilingual natural language processing tasks and for applications that </span>
    <span class="c1">#                require word sense alignment across different languages.</span>
    <span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;omw-1.4&#39;</span><span class="p">)</span>

    <span class="c1"># Fix the list of categories of features</span>
    <span class="n">featureCategories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LinkingRate&#39;</span><span class="p">,</span> <span class="s1">&#39;SynonymRate&#39;</span><span class="p">,</span> <span class="s1">&#39;Diversity&#39;</span><span class="p">,</span> <span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> <span class="s1">&#39;Discourse&#39;</span><span class="p">]</span>
    
    <span class="c1"># Read the configuration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">read_config</span><span class="p">()</span>

    <span class="c1"># Use the configuration values</span>
    <span class="n">rootDirPath</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;rootDirPath&#39;</span><span class="p">]</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span>
    <span class="n">dimension</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dimension&#39;</span><span class="p">]</span>
    <span class="n">clip</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;clip&#39;</span><span class="p">]</span>

    <span class="c1"># Example usage in your script</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Root Directory Path: </span><span class="si">{</span><span class="n">rootDirPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dimension: </span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clip: </span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Adding the rootDirPath to the system path</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rootDirPath</span><span class="p">)</span>
    <span class="c1"># Read meta information about the dataset</span>
    <span class="n">readMeta</span><span class="p">()</span>
    <span class="n">TextProcess</span><span class="p">()</span>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Public Speaking Automatic Assessment with AudioTextual Features</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Project Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_config.html">Configuration File</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Code du module</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, Alisa Barkar, Valentine Fleith.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>